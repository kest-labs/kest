# Kest CLI ä½¿ç”¨æŒ‡å— (User Guide)

Kest CLI æ˜¯ä¸€ä¸ªä¸“ä¸ºå¼€å‘è€…è®¾è®¡çš„ **CLI-first** API æµ‹è¯•å·¥å…·ã€‚å®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ï¼š**å³æ—¶æµ‹è¯•ï¼Œè‡ªåŠ¨è®°å½•ï¼Œè½»æ¾å›æ”¾**ã€‚

---

## 1. å®‰è£… (Installation)

ç¡®ä¿ä½ å·²ç»å®‰è£…äº† Go ç¯å¢ƒï¼Œç„¶åè¿è¡Œï¼š

```bash
go install github.com/kest-lab/kest-cli/cmd/kest@latest
```

å®‰è£…å®Œæˆåï¼Œè¯·ç¡®ä¿ `$(go env GOPATH)/bin` å·²åŠ å…¥ä½ çš„ç³»ç»Ÿ `PATH`ã€‚

---

## 2. å¿«é€Ÿå¼€å§‹ (Quick Start)

### 2.1 åˆå§‹åŒ–é¡¹ç›®
åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œï¼Œè¿™ä¼šåˆ›å»ºä¸€ä¸ª `.kest/config.yaml` é…ç½®æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰åŸºç¡€ URLã€ç¯å¢ƒå˜é‡å’Œé»˜è®¤ Headerã€‚

```bash
kest init
```

### 2.2 å‘èµ·è¯·æ±‚
Kest æ”¯æŒæ‰€æœ‰æ ‡å‡†çš„ HTTP æ–¹æ³•ï¼Œå¹¶åœ¨å‘é€è¯·æ±‚å**è‡ªåŠ¨ä¿å­˜**ç»“æœã€‚å®ƒçš„å‘½ä»¤è¡Œè®¾è®¡æå…¶ç²¾ç®€ï¼Œéå¸¸é€‚åˆåœ¨ **Vibe Coding**ï¼ˆå¦‚åœ¨ Cursor/Windsurf çš„ Terminal ä¸­ä¸ AI ååŒï¼‰æ—¶ä½¿ç”¨ã€‚

#### å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹
```bash
# GET è¯·æ±‚ (æ”¯æŒç›¸å¯¹è·¯å¾„ï¼Œè‡ªåŠ¨è¡¥å…¨ base_url)
kest get /users/1

# POST è¯·æ±‚ (é»˜è®¤ä½¿ç”¨ application/json)
kest post /users -d '{"name": "stark"}'

# å¸¦è‡ªå®šä¹‰ Header
kest get /protected -H "Authorization: Bearer token123"

# å¸¦å¤šä¸ª Query å‚æ•°
kest get /search -q "q=kest" -q "page=1"

# ä½¿ç”¨ç®€å†™ (å¦‚æœå¯ç”¨äº†åˆ«åï¼Œå¯é€‰)
kest p /users -d '{"email": "test@example.com"}'
```

#### åœ¨ Vibe Coding ä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ

Vibe Coding å¼ºè°ƒ**æµå¼ã€é«˜é¢‘ã€ä½é˜»åŠ›**çš„å¼€å‘ä½“éªŒã€‚Kest é€šè¿‡ä»¥ä¸‹æ–¹å¼é€‚é…è¿™ç§é£æ ¼ï¼š

1.  **é›¶é…ç½®å¿ƒæ™º**: ä½ ä¸éœ€è¦é¢„å…ˆåœ¨ UI ç•Œé¢åˆ›å»º Collectionã€‚æƒ³æµ‹å“ªä¸ªæ¥å£ï¼Œç›´æ¥åœ¨ Terminal è¾“å…¥å‘½ä»¤ã€‚
2.  **ç»“åˆ AI ååŒ**: 
    *   ä½ å¯ä»¥ç›´æ¥å‘Šè¯‰ AIï¼šâ€œå¸®æˆ‘ç”¨ kest è°ƒç”¨ä¸€ä¸‹åˆ›å»ºè®¢å•æ¥å£â€ã€‚
    *   AI ä¼šç”Ÿæˆç±»ä¼¼çš„å‘½ä»¤ï¼š`kest post /orders -d '{"item_id": 101, "count": 2}'`ã€‚
    *   æ‰§è¡Œåï¼ŒKest è‡ªåŠ¨ä¿å­˜äº† Request å’Œ Responseã€‚å¦‚æœæŠ¥é”™ï¼Œä½ ç›´æ¥æŠŠè¾“å‡ºç”©ç»™ AIï¼Œä¸éœ€è¦æ‰‹åŠ¨æˆªå›¾æˆ–å¤åˆ¶å„ç§ Headerã€‚
3.  **å†å²å³æ–‡æ¡£**: åœ¨ Vibe Coding è¿‡ç¨‹ä¸­ï¼Œä½ ä¸éœ€è¦åˆ†å¿ƒå»æ›´æ–°æ–‡æ¡£ã€‚ä½ çš„ `kest history` å°±æ˜¯æœ€çœŸå®ã€æœ€æ–°çš„ API è°ƒç”¨è®°å½•ã€‚
4.  **å¿«é€Ÿå›æ”¾éªŒè¯**: å½“ä½ è®© AI ä¿®æ”¹äº†æŸæ®µåç«¯é€»è¾‘åï¼Œç›´æ¥æ‰§è¡Œ `kest replay last --diff`ï¼Œç§’çº§éªŒè¯é€»è¾‘æ”¹åŠ¨æ˜¯å¦å½±å“äº†æ¥å£è¾“å‡ºï¼Œæ— éœ€ç¦»å¼€ IDEã€‚

#### Pro Tips ä¸º Vibe Coding åŠ é€Ÿ
*   **é…åˆ `grep` æˆ– `jq`**: Kest è¾“å‡ºçš„æ˜¯æ ‡å‡† JSONï¼ˆå¯¹äº Bodyï¼‰ï¼Œä½ å¯ä»¥ç›´æ¥ `kest get /users | jq '.[0].id'`ã€‚
*   **åˆ«åå»ºè®®**: å»ºè®®åœ¨ä½ çš„ `.zshrc` æˆ– `.bashrc` ä¸­æ·»åŠ  `alias k='kest'`ï¼Œè¿™æ ·æµ‹è¯•æ¥å£åªéœ€è¦ `k get /path`ï¼Œæ•ˆç‡ç¿»å€ã€‚
*   **ä¸€é”®æŠ¥é”™ä¸Šä¸‹æ–‡**: å½“è¯·æ±‚å¤±è´¥æ—¶ï¼Œä½ å¯ä»¥ç›´æ¥å¯¹ AI è¯´ï¼šâ€œæŸ¥çœ‹æœ€åä¸€æ¡ kest è®°å½•å¹¶ä¿®å¤åç«¯ä»£ç â€ï¼ŒAI å¯ä»¥é€šè¿‡è®¿é—® Kest çš„æœ¬åœ°æ•°æ®åº“æˆ–ä½ æ‰§è¡Œ `kest show last` çš„è¾“å‡ºæ¥è·å–å®Œæ•´ä¸Šä¸‹æ–‡ã€‚

---

## 3. è¿›é˜¶ç‰¹æ€§ï¼šå˜é‡ä¸æ–­è¨€ (Advanced Features)

å€Ÿé‰´äº† Hurl çš„ç²¾åï¼ŒKest æ”¯æŒåœ¨å‘½ä»¤è¡Œç›´æ¥è¿›è¡Œ**å˜é‡æ•è·**å’Œ**é€»è¾‘æ–­è¨€**ï¼Œè¿™æå¤§åœ°ç®€åŒ–äº†æ¥å£è”åŠ¨æµ‹è¯•ã€‚

### 3.1 å˜é‡æ•è· (Captures)
ä½ å¯ä»¥ä»å“åº” Body ä¸­æå–å­—æ®µå¹¶ä¿å­˜ä¸ºå˜é‡ï¼Œä¾›åç»­è¯·æ±‚ä½¿ç”¨ã€‚Kest ä½¿ç”¨ **JSONPath (gjson)** è¯­æ³•ã€‚

```bash
# ä»ç™»å½•å“åº”ä¸­æ•è· token
kest post /login -d '{"user":"admin"}' -c "token=auth.token"

# æŸ¥çœ‹å·²ä¿å­˜çš„å˜é‡
kest vars

# åœ¨åç»­è¯·æ±‚ä¸­ä½¿ç”¨å˜é‡
kest get /profile -H "Authorization: Bearer {{token}}"
```

### 3.2 é€»è¾‘æ–­è¨€ (Assertions)
åœ¨å‘èµ·è¯·æ±‚æ—¶ç›´æ¥éªŒè¯ç»“æœï¼Œå¤±è´¥æ—¶ä¼šæ˜¾å¼æç¤ºã€‚

```bash
# éªŒè¯çŠ¶æ€ç å’Œ Body å­—æ®µ
kest get /users/1 -a "status=200" -a "body.name=stark"

# é…åˆå˜é‡éªŒè¯è”åŠ¨é€»è¾‘
kest get /orders/{{last_id}} -a "status=200" -a "body.status=pending"
```

---

## 4. å†å²è®°å½•ä¸è¿½æº¯ (History & Tracing)

Kest æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯å®ƒä¼šè‡ªåŠ¨è®°å½•ä½ æ¯ä¸€æ¬¡çš„æ•²å‡»ã€‚

### 3.1 æŸ¥çœ‹å†å²
é»˜è®¤æƒ…å†µä¸‹ï¼Œ`history` ä»…æ˜¾ç¤ºå½“å‰é¡¹ç›®çš„è®°å½•ã€‚

```bash
# æŸ¥çœ‹å½“å‰é¡¹ç›®æœ€è¿‘ 20 æ¡è®°å½•
kest history

# æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®çš„å…¨å±€å†å²
kest history --global

# æŒ‡å®šæŸ¥çœ‹æ•°é‡
kest history -n 50
```

### 3.2 æŸ¥çœ‹è¯¦æƒ…
ä½ å¯ä»¥æŸ¥çœ‹ä»»ä½•ä¸€æ¡å†å²è®°å½•çš„å®Œæ•´ Request å’Œ Responseï¼ˆåŒ…æ‹¬å…¨éƒ¨ Headers å’Œæ ¼å¼åŒ–åçš„ Bodyï¼‰ã€‚

```bash
# æŸ¥çœ‹æŒ‡å®š ID çš„è®°å½•
kest show 42

# å¿«é€ŸæŸ¥çœ‹æœ€åä¸€æ¡è®°å½•
kest show last
```

---

## 4. å›æ”¾ä¸å¯¹æ¯” (Replay & Diff)

å½“ä½ ä¿®æ”¹äº†ä»£ç ï¼Œæƒ³éªŒè¯æ¥å£ç»“æœæ˜¯å¦å‘ç”Ÿéé¢„æœŸå˜åŒ–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `replay`ã€‚

### 4.1 é‡æ–°æ‰§è¡Œ
```bash
kest replay 42
```

### 4.2 ç»“æœå¯¹æ¯” (Visual Diff)
Kest ä¼šè‡ªåŠ¨æŠ“å–å›æ”¾çš„æ–°ç»“æœï¼Œå¹¶ä¸æ—§è®°å½•è¿›è¡Œ Body çº§åˆ«çš„å¯¹æ¯”ã€‚

```bash
kest replay 42 --diff
```

---

## 5. ç¯å¢ƒç®¡ç† (Environments)

åœ¨ `.kest/config.yaml` ä¸­ä½ å¯ä»¥å®šä¹‰å¤šä¸ªç¯å¢ƒï¼ˆå¦‚ `dev`, `staging`, `prod`ï¼‰ã€‚

### 5.1 æŸ¥çœ‹ä¸åˆ‡æ¢ç¯å¢ƒ
```bash
# åˆ—å‡ºæ‰€æœ‰ç¯å¢ƒ
kest env list

# åˆ‡æ¢åˆ° staging ç¯å¢ƒ
kest env use staging
```

åˆ‡æ¢ç¯å¢ƒåï¼Œæ‰€æœ‰ç›¸å¯¹è·¯å¾„çš„ URL (å¦‚ `/users`) éƒ½ä¼šè‡ªåŠ¨æ‹¼æ¥è¯¥ç¯å¢ƒå¯¹åº”çš„ `base_url`ã€‚

---

## 6. é…ç½®å‚è€ƒ (Config.yaml)

```yaml
version: 1
defaults:
  timeout: 30
  headers:
    Content-Type: application/json
    Accept: application/json

environments:
  dev:
    base_url: http://localhost:3000
  staging:
    base_url: https://staging-api.example.com
  prod:
    base_url: https://api.example.com

active_env: dev
```

---

## 7. æ•°æ®å­˜å‚¨ä½ç½®

*   **å…¨å±€æ•°æ®åº“**: `~/.kest/records.db` (å­˜å‚¨æ‰€æœ‰æµ‹è¯•è®°å½•)
*   **å…¨å±€é…ç½®**: `~/.kest/config.yaml`
*   **é¡¹ç›®é…ç½®**: å½“å‰é¡¹ç›®ç›®å½•ä¸‹çš„ `.kest/config.yaml`

---

*Happy Vibe Coding!* ğŸš€
